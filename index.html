<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rayyan Inventory System</title>

<style>
body{
font-family:Arial;
margin:0;
padding:15px;
background:#f4f6f9;
}

h2{margin-top:0}

.topbar{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10px;
}

button{
padding:6px 12px;
border:none;
border-radius:6px;
cursor:pointer;
background:#111;
color:white;
}

button:hover{opacity:0.85}

input{
width:100%;
padding:8px;
margin:5px 0;
border-radius:6px;
border:1px solid #ccc;
}

.card{
background:white;
padding:10px;
margin-bottom:10px;
border-radius:10px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

img{
width:100%;
height:150px;
object-fit:contain;
background:#fff;
}

.low{color:orange;font-weight:bold}
.out{color:red;font-weight:bold}
.instock{color:green;font-weight:bold}

.admin{
display:none;
background:#fff;
padding:10px;
border-radius:10px;
margin-top:15px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.stats{
background:white;
padding:10px;
border-radius:10px;
margin-bottom:10px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

#notification{
position:fixed;
top:10px;
right:10px;
background:red;
color:white;
padding:10px;
border-radius:8px;
display:none;
}
</style>
</head>

<body>

<div id="notification"></div>

<div class="topbar">
<h2>Rayyan Mobile & Repairing</h2>
<button onclick="adminLogin()">Admin Panel</button>
</div>

<div class="stats">
<p><b>Total Products:</b> <span id="totalProducts">0</span></p>
<p><b>Total Stock Value:</b> ₹ <span id="totalValue">0</span></p>
</div>

<input id="search" placeholder="Search Product..." onkeyup="render()">

<div id="productList"></div>

<h3>Low Stock Products</h3>
<ul id="lowList"></ul>

<div class="admin" id="adminBox">
<h3>Admin Panel</h3>
<input id="name" placeholder="Product Name">
<input id="image" placeholder="Image URL">
<input id="price" type="number" placeholder="Price">
<input id="stock" type="number" placeholder="Stock">
<button onclick="addProduct()">Add Product</button>
<button onclick="logout()">Logout</button>
</div>

<script>

const API = "https://script.google.com/macros/s/AKfycbx8QBvnuI15PFJAGSdnljcVBK4aRcrkJKZEqlj3LyW9LnflGhfsMxa6jtTyBF_xG3jb/exec";

let products = [];

async function fetchProducts(){
try{
let response = await fetch(API);
let data = await response.json();
products = data;
render();
updateStats();
checkLowStockNotification();
}catch(error){
console.log("Fetch Error:",error);
}
}

function render(){
let search=document.getElementById("search").value.toLowerCase();
let list=document.getElementById("productList");
let lowList=document.getElementById("lowList");

list.innerHTML="";
lowList.innerHTML="";

products.forEach(p=>{

if(!p || p.length < 5) return;

let id=p[0];
let name=p[1];
let image=p[2];
let price=parseFloat(p[3]);
let stock=parseInt(p[4]);

if(name.toLowerCase().includes(search)){

let status="instock";
if(stock===0) status="out";
else if(stock<=2) status="low";

list.innerHTML+=`
<div class="card">
<img src="${image}" onerror="this.src='https://via.placeholder.com/150'">
<h4>${name}</h4>
<p>₹ ${price}</p>
<p class="${status}">Stock: ${stock}</p>
<button onclick="updateStock('${id}',${stock+1})">+</button>
<button onclick="updateStock('${id}',${stock-1})">-</button>
<button onclick="deleteProduct('${id}')">Delete</button>
</div>
`;

if(stock<=2){
lowList.innerHTML+=`<li>${name} - ${stock}</li>`;
}
}
});
}

async function addProduct(){

let productName=document.getElementById("name").value.trim();
let imageUrl=document.getElementById("image").value.trim();
let priceValue=document.getElementById("price").value;
let stockValue=document.getElementById("stock").value;

if(!productName || !priceValue || !stockValue){
alert("Fill all fields");
return;
}

await fetch(API,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({
action:"add",
name:productName,
image:imageUrl,
price:priceValue,
stock:stockValue
})
});

document.getElementById("name").value="";
document.getElementById("image").value="";
document.getElementById("price").value="";
document.getElementById("stock").value="";

fetchProducts();
}

async function deleteProduct(id){
await fetch(API,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({action:"delete",id})
});
fetchProducts();
}

async function updateStock(id,newStock){
if(newStock<0) newStock=0;
await fetch(API,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({action:"updateStock",id,stock:newStock})
});
fetchProducts();
}

function updateStats(){
let totalProducts=products.length;
let totalValue=0;

products.forEach(p=>{
if(p && p.length>=5){
totalValue += parseFloat(p[3]) * parseInt(p[4]);
}
});

document.getElementById("totalProducts").innerText=totalProducts;
document.getElementById("totalValue").innerText=totalValue;
}

function adminLogin(){
if(prompt("Password?")==="admin"){
document.getElementById("adminBox").style.display="block";
}
}

function logout(){
document.getElementById("adminBox").style.display="none";
}

function checkLowStockNotification(){
let lowItems=products.filter(p=>p && parseInt(p[4])<=2);
if(lowItems.length>0){
let note=document.getElementById("notification");
note.innerText="Low Stock Alert: "+lowItems.length+" product(s)";
note.style.display="block";
setTimeout(()=>note.style.display="none",3000);
}
}

setInterval(fetchProducts,3000);
fetchProducts();

</script>

</body>
  </html>
